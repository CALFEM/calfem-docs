exs_flw_diff2
^^^^^^^^^^^^^

:Purpose: Show how to solve a two dimensional diffusion problem.

:Description: Consider a filter paper of square shape. Three sides are in contact with pure water and the fourth side is in contact with a solution of concentration :math:`c=1.0 \cdot 10^{-3}` kg/mÂ³. The length of each side is 0.100 m. Using symmetry, only half of the paper has to be analyzed. The paper and the corresponding finite element mesh are shown. The following boundary conditions are applied:

.. only:: html
    
    .. figure:: images/exs8f1.svg
        :align: center
        :width: 400px

.. only:: latex
    
    .. figure:: images/exs8f1.svg
        :align: center
        :width: 70%

:Example: The element topology is defined by the topology matrix:

.. code-block:: matlab

   >> Edof=[1   1  2  5  4
            2   2  3  6  5
            3   4  5  8  7
            4   5  6  9  8
            5   7  8 11 10
            6   8  9 12 11
            7  10 11 14 13
            8  11 12 15 14];
            
The system matrices, i.e. the stiffness matrix ``K`` and the load vector ``f``, are defined by:

.. code-block:: matlab

   >> K=zeros(15);   f=zeros(15,1);

Because of the same geometry, orientation, and constitutive matrix for all elements, only one element stiffness matrix ``Ke`` has to be computed. This is done by the function ``flw2qe``:

.. code-block:: matlab

   >> ep=1;     D=[1 0; 0 1];

   >> ex=[0 0.025 0.025 0];     ey=[0 0 0.025 0.025];

   >> Ke=flw2qe(ex,ey,ep,D)

   >> Ke =

       0.7500   -0.2500   -0.2500   -0.2500
      -0.2500    0.7500   -0.2500   -0.2500
      -0.2500   -0.2500    0.7500   -0.2500
      -0.2500   -0.2500   -0.2500    0.7500

Based on the topology information, the global stiffness matrix is generated by assembling this element stiffness matrix ``Ke`` in the global stiffness matrix ``K``:

.. code-block:: matlab

   >> K=assem(Edof,K,Ke);

Finally, the solution is calculated by defining the boundary conditions ``bc`` and solving the system of equations. The boundary condition at dof 13 is set to :math:`0.5 \cdot 10^{-3}` as an average of the concentrations at the neighbouring boundaries. Concentrations ``a`` and unknown boundary flows ``r`` are computed by the function ``solveq``:

.. code-block:: matlab

   >> bc=[1 0;2 0;3 0;4 0;7 0;10 0;13 0.5e-3;14 1e-3;15 1e-3];

   >> [a,r]=solveq(K,f,bc);

The element flows ``q`` are calculated from element concentration ``Ed``:

.. code-block:: matlab

   >> Ed=extract_ed(Edof,a);

   >> for i=1:8
        Es=flw2qs(ex,ey,ep,D,Ed(i,:));
      end

**Results:**

.. code-block:: none

   a=                    r=
     1.0e-003 *           1.0e-003 *

            0              -0.0165
            0              -0.0565
            0              -0.0399
            0              -0.0777
       0.0662               0.0000
       0.0935                    0
            0              -0.2143
       0.1786               0.0000
       0.2500               0.0000
            0              -0.6366
       0.4338               0.0000
       0.5494              -0.0000
       0.5000               0.0165
       1.0000               0.7707
       1.0000               0.2542



   Es =
      -0.0013   -0.0013
      -0.0005   -0.0032
      -0.0049   -0.0022
      -0.0020   -0.0054
      -0.0122   -0.0051
      -0.0037   -0.0111
      -0.0187   -0.0213
      -0.0023   -0.0203

The following ``.m``-file shows an alternative set of commands to perform the diffusion analysis of ``exs_flw_diff2``. By use of global coordinates, an FE-mesh is generated. Also plots with flux-vectors and contour lines are created:

.. code-block:: matlab

   % ----- System matrices -----

   K=zeros(15);  f=zeros(15,1);
   Coord=[0     0    ; 0.025 0    ; 0.05  0
          0     0.025; 0.025 0.025; 0.05  0.025
          0     0.05 ; 0.025 0.05 ; 0.05  0.05
          0     0.075; 0.025 0.075; 0.05  0.075
          0     0.1  ; 0.025 0.1  ; 0.05  0.1  ];
   Dof=[1; 2; 3
        4; 5; 6
        7; 8; 9
       10;11;12
       13;14;15];

   % ----- Element properties, topology and coordinates -----

   ep=1; D=[1 0;0 1];
   Edof=[1   1  2  5  4
         2   2  3  6  5
         3   4  5  8  7
         4   5  6  9  8
         5   7  8 11 10
         6   8  9 12 11
         7  10 11 14 13
         8  11 12 15 14];
   [Ex,Ey]=coordxtr(Edof,Coord,Dof,4);

   % ----- Generate FE-mesh -----

   eldraw2(Ex,Ey,[1 3 0],Edof(:,1));
   pause; clf;

   % ----- Create and assemble element matrices -----

   for i=1:8
     Ke=flw2qe(Ex(i,:),Ey(i,:),ep,D);
     K=assem(Edof(i,:),K,Ke);
   end;

   % ----- Solve equation system -----

   bc=[1 0;2 0;3 0;4 0;7 0;10 0;13 0.5e-3;14 1e-3;15 1e-3];
   [a,r]=solveq(K,f,bc)

   % ----- Compute element flux vectors -----

    Ed=extract_ed(Edof,a);
    for i=1:8
      Es(i,:)=flw2qs(Ex(i,:),Ey(i,:),ep,D,Ed(i,:))
    end

   % ----- Draw flux vectors and contour lines -----
    sfac=scalfact2(Ex,Ey,Es,0.5);
    eldraw2(Ex,Ey,[1,3,0]);
    elflux2(Ex,Ey,Es,[1,4],sfac);
    pltscalb2(sfac,[2e-2 0.06 0.01],4);
    pause; clf;
    eldraw2(Ex,Ey,[1,3,0]);
    eliso2(Ex,Ey,Ed,5,[1,4]);

.. only:: html
    
    .. figure:: images/exs8f2.svg
        :align: center
        :width: 400px

.. only:: latex
    
    .. figure:: images/exs8f2.svg
        :align: center
        :width: 70%

   Flux vectors

.. only:: html
    
    .. figure:: images/exs8f3.svg
        :align: center
        :width: 400px

.. only:: latex
    
    .. figure:: images/exs8f3.svg
        :align: center
        :width: 70%

   Contour lines

.. note::

    Two comments concerning the contour lines:

    In the upper left corner, the contour lines should physically have met at the corner point. However, the drawing of the contour lines for the ``planqe`` element follows the numerical approximation along the element boundaries, i.e. a linear variation. A finer element mesh will bring the contour lines closer to the corner point.

    Along the symmetry line, the contour lines should physically be perpendicular to the boundary. This will also be improved with a finer element mesh.

    With the MATLAB functions ``colormap`` and ``fill`` a color plot of the concentrations can be obtained:

    .. code-block:: matlab

        colormap('jet')
        fill(Ex',Ey',Ed')
        axis equal
