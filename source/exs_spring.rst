exs_spring
^^^^^^^^^^

.. index:: exs_spring

:Purpose:

    Show the basic steps in a finite element calculation.

:Description:

    The general procedure in linear finite element calculations is carried out for a simple structure. The steps are:

    * Define the model
    * Generate element matrices
    * Assemble element matrices into the global system of equations
    * Solve the global system of equations
    * Evaluate element forces

    Consider the system of three linear elastic springs, and the corresponding finite element model. The system of springs is fixed in its ends and loaded by a single load :math:`F`.

    .. only:: html
        
        .. figure:: images/exs1_1.svg
            :align: center
            :width: 30em
    
    .. only:: latex
        
        .. figure:: images/exs1_1.svg
            :align: center
            :width: 70%

    .. only:: html
        
        .. figure:: images/exs1_2.svg
            :align: center
            :width: 40em
    
    .. only:: latex
        
        .. figure:: images/exs1_2.svg
            :align: center
            :width: 70%

:Example:

    The computation is initialized by importing CALFEM and NumPy, then defining the topology matrix :code:`edof` containing the degrees of freedom for each element:

    .. code-block:: python

        import numpy as np
        import calfem.core as cfc
        import calfem.utils as cfu

        edof = np.array([
            [1, 2],                 # element 1 between nodes 1 and 2
            [2, 3],                 # element 2 between nodes 2 and 3
            [2, 3]                  # element 3 between nodes 2 and 3
        ])

    The global stiffness matrix :code:`K` (3×3) of zeros:

    .. code-block:: python

        K = np.zeros((3, 3))        # empty global stiffness matrix
        f = np.zeros((3, 1))        # empty global load vector        

    And the load vector :code:`f` (3×1) with the load :math:`F=100` at DOF 2:

    .. code-block:: python

        K = np.zeros((3, 3))        # empty global stiffness matrix
        f = np.zeros((3, 1))        # empty global load vector

        f[1] = 100.0                # (N), f[1] corresponds to dof 2

    Element stiffness matrices are generated by the function :code:`cfc.spring1e`. The element property :code:`ep` for the springs contains the spring stiffnesses :math:`k` and :math:`2k` respectively, where :math:`k=1500`:

    .. tabs::

        .. tab:: Code

            .. code-block:: python

                k = 1500.                   # (N/m)
                ep1 = 2.*k                  # spring stiffness, element 1
                ep2 = k                     # spring stiffness, element 2
                ep3 = 2.*k                  # spring stiffness, element 3
                Ke1 = cfc.spring1e(ep1)     # element stiffness matrix, element 1
                Ke2 = cfc.spring1e(ep2)     # element stiffness matrix, element 2
                Ke3 = cfc.spring1e(ep3)     # element stiffness matrix, element 3

                cfu.disp_h2("Ke1")
                cfu.disp_array(Ke1, tablefmt='plain')
                cfu.disp_h2("Ke2")
                cfu.disp_array(Ke2, tablefmt='plain')
                cfu.disp_h2("Ke3")
                cfu.disp_array(Ke3, tablefmt='plain')

        .. tab:: Output

            .. code:: 

                ## Ke1

                3.0000e+03  -3.0000e+03
                -3.0000e+03   3.0000e+03

                ## Ke2

                1.5000e+03  -1.5000e+03
                -1.5000e+03   1.5000e+03

                ## Ke3

                3.0000e+03  -3.0000e+03
                -3.0000e+03   3.0000e+03                    

    The element stiffness matrices are assembled into the global stiffness matrix :code:`K` according to the topology:

    .. tabs::

        .. tab:: Code

            .. code:: python

                cfc.assem(edof[0, :], K, Ke1)   # assemble element stiffness matrix 1
                cfc.assem(edof[1, :], K, Ke2)   # assemble element stiffness matrix 2
                cfc.assem(edof[2, :], K, Ke3)   # assemble element stiffness matrix 3

                cfu.disp_h2("Stiffness matrix K (N/m):")
                cfu.disp_array(K, tablefmt='plain')

        .. tab:: Output

            .. code::

                ## Stiffness matrix K (N/m):

                3.0000e+03  -3.0000e+03   0.0000e+00
                -3.0000e+03   7.5000e+03  -4.5000e+03
                0.0000e+00  -4.5000e+03   4.5000e+03

    The global system of equations is solved considering the boundary conditions. DOFs 1 and 3 are fixed (value 0):

    .. tabs::

        .. tab:: Code

            .. code-block:: python

                bc_dofs = np.array([1, 3])       # dofs with prescribed displacment (0)
                bc_vals = np.array([0.0, 0.0])   # prescribed displacments

                a, r = cfc.solveq(K, f, bc_dofs, bc_vals)

                cfu.disp_h2("Displacements a (m):")
                cfu.disp_array(a, tablefmt="plain")

                cfu.disp_h2("Reaction forces fb (N):")
                cfu.disp_array(fb, tablefmt="plain")

        .. tab:: Output

            .. code::

                ## Displacements a (m):

                0.0000e+00
                1.3333e-02
                0.0000e+00

                ## Reaction forces r (N):

                -4.0000e+01
                0.0000e+00
                -6.0000e+01


    Element forces are evaluated from the element displacements. These are obtained from the global displacements :code:`a` using the function :code:`cfc.extract_ed` and the spring forces are evaluated using the function :code:`cfc.spring1s`:

    .. tabs::

        .. tab:: Code

            .. code-block:: python

                ed1 = cfc.extract_ed(edof[0, :], a) # Nodal displacements, element 1
                ed2 = cfc.extract_ed(edof[1, :], a) # Nodal displacements, element 2
                ed3 = cfc.extract_ed(edof[2, :], a) # Nodal displacements, element 3

                es1 = cfc.spring1s(ep1, ed1)        # Element force, element 1
                es2 = cfc.spring1s(ep2, ed2)        # Element force, element 2
                es3 = cfc.spring1s(ep3, ed3)        # Element force, element 3

                cfu.disp_h2("Element forces (N):")
                print("N1 = "+str(es1))
                print("N2 = "+str(es2))
                print("N3 = "+str(es3))

        .. tab:: Output

            .. code::

                ## Element forces (N):

                N1 = 40.0
                N2 = -20.0
                N3 = -40.0            
